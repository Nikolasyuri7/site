<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Percep√ß√£o Musical | Nikolas Yuri</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <div class="logo">
      <img src="piano-icon.png" alt="Imagem" />
      <span>NIKOLAS YURI</span>
    </div>
    <nav class="menu">
      <a href="index.html">In√≠cio</a>
      <a href="percepcao.html" class="active">Percep√ß√£o</a>
    </nav>
  </header>

  <main>
    <section class="hero" style="background: none;">
      <div class="cta-box">
        <h1>Jogo de Percep√ß√£o Musical</h1>
        <p>Escolha o n√≠vel de dificuldade para come√ßar:</p>
        <div id="level-select">
          <button onclick="selectLevel('facil')" class="button">F√°cil</button>
          <button onclick="selectLevel('medio')" class="button">M√©dio</button>
          <button onclick="selectLevel('dificil')" class="button">Dif√≠cil</button>
        </div>
        <div id="game" style="display:none;">
          <p id="status">Clique em "Iniciar" para come√ßar</p>
          <button onclick="startGame()" class="button">Iniciar</button>
          <button onclick="playChord()" id="repeat-btn" style="display:none;" class="button">Repetir Acorde</button>
          <div id="choices" style="margin-top: 20px; display: none;">
            <button onclick="checkAnswer('maior')" class="button"><i class="fas fa-arrow-up"></i> Maior</button>
            <button onclick="checkAnswer('menor')" class="button"><i class="fas fa-arrow-down"></i> Menor</button>
            <button onclick="checkAnswer('diminuto')" id="dimBtn" class="button" style="display: none;">Diminuto</button>
            <button onclick="checkAnswer('aumentado')" id="aumBtn" class="button" style="display: none;">Aumentado</button>
            <button onclick="checkAnswer('7')" id="setimaBtn" class="button" style="display: none;">7¬™ Menor</button>
            <button onclick="checkAnswer('7M')" id="setimaMaiorBtn" class="button" style="display: none;">7¬™ Maior</button>
          </div>
        </div>
        <div id="result" style="margin-top: 30px;"></div>
      </div>
    </section>
  </main>

  <footer>
    <p>NIKOLAS YURI</p>
    <div class="social">
      <a href="#"><img src="nikolas.jpg" alt="Imagem" /></a>
      <a href="#"><img src="nikolas.jpg" alt="Imagem" /></a>
      <a href="#"><img src="nikolas.jpg" alt="Imagem" /></a>
    </div>
  </footer>

  <script>
    const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const context = new (window.AudioContext || window.webkitAudioContext)();
    let currentChord = null, score = 0, round = 0, startTime, currentLevel = 'facil', activeSources = [];

    function noteToFrequency(note) {
      const noteFreqMap = {
        C: 261.63, 'C#': 277.18, D: 293.66, 'D#': 311.13, E: 329.63,
        F: 349.23, 'F#': 369.99, G: 392.00, 'G#': 415.30,
        A: 440.00, 'A#': 466.16, B: 493.88
      };
      return noteFreqMap[note];
    }

    function playFrequency(freq) {
      const osc = context.createOscillator();
      const gain = context.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, context.currentTime);
      gain.gain.setValueAtTime(0.1, context.currentTime); // volume reduzido
      osc.connect(gain);
      gain.connect(context.destination);
      osc.start();
      osc.stop(context.currentTime + 2); // toca por 2 segundos
      return { osc, gain };
    }

    function playChord() {
      stopChord();
      const { root, type } = currentChord;
      const intervals = {
        maior: [0, 4, 7],
        menor: [0, 3, 7],
        diminuto: [0, 3, 6],
        aumentado: [0, 4, 8],
        '7': [0, 4, 7, 10],
        '7M': [0, 4, 7, 11]
      }[type];
      const rootIndex = notes.indexOf(root);
      activeSources = [];
      for (let i of intervals) {
        const noteName = notes[(rootIndex + i) % notes.length];
        const freq = noteToFrequency(noteName);
        const src = playFrequency(freq);
        activeSources.push(src);
      }
      document.getElementById('repeat-btn').style.display = 'inline-block';
    }

    function stopChord() {
      activeSources.forEach(({ osc, gain }) => {
        gain.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.2);
        osc.stop(context.currentTime + 0.2);
      });
      activeSources = [];
    }

    function selectLevel(level) {
      currentLevel = level;
      document.getElementById('level-select').style.display = 'none';
      document.getElementById('game').style.display = 'block';
      ['dimBtn', 'aumBtn', 'setimaBtn', 'setimaMaiorBtn'].forEach(id =>
        document.getElementById(id).style.display = (level === 'facil'
          ? 'none' : (level === 'medio'
            ? (id === 'dimBtn' || id === 'aumBtn' ? 'inline-block' : 'none')
            : 'inline-block'))
      );
    }

    function startGame() {
      score = 0; round = 0; startTime = Date.now();
      document.getElementById('result').innerHTML = '';
      nextRound();
    }

    function getRandomChord() {
      const types = {
        facil: ['maior', 'menor'],
        medio: ['maior', 'menor', 'diminuto', 'aumentado'],
        dificil: ['maior', 'menor', 'diminuto', 'aumentado', '7', '7M']
      }[currentLevel];
      const root = notes[Math.floor(Math.random() * notes.length)];
      return { root, type: types[Math.floor(Math.random() * types.length)] };
    }

    function nextRound() {
      if (round >= 10) return endGame();
      round++;
      currentChord = getRandomChord();
      document.getElementById('status').textContent = `Rodada ${round} de 10`;
      document.getElementById('choices').style.display = 'block';
      playChord();
    }

    function checkAnswer(answer) {
      stopChord();
      if (answer === currentChord.type) score++;
      nextRound();
    }

    function endGame() {
      stopChord();
      const timeTaken = Math.floor((Date.now() - startTime) / 1000);
      const perc = ((10 - score) / 10) * 100;
      const color = perc < 50 ? 'red' : perc > 80 ? 'green' : 'white';
      document.getElementById('status').textContent = 'Jogo finalizado!';
      document.getElementById('choices').style.display = 'none';
      document.getElementById('repeat-btn').style.display = 'none';
      document.getElementById('result').innerHTML = `
        <p><strong>Resultado:</strong> ${score} de 10</p>
        <p style="color:${color};"><strong>Erros:</strong> ${perc.toFixed(1)}%</p>
        <p><strong>Tempo:</strong> ${Math.floor(timeTaken/60)}m ${timeTaken%60}s</p>
        <a href="#" onclick="startGame()" class="button">üîÅ Continuar neste n√≠vel</a>
        <a href="#" onclick="window.location.reload()" class="button">üîÑ Escolher outro n√≠vel</a>
      `;
    }

    window.playChord = playChord;
    window.startGame = startGame;
    window.checkAnswer = checkAnswer;
    window.selectLevel = selectLevel;
  </script>
</body>
</html>
